services:
  open-webui:
    environment:
      # https://docs.openwebui.com/getting-started/advanced-topics/env-configuration
      WEBUI_AUTH: True
      ENABLE_FORWARD_USER_INFO_HEADERS: True
      ENABLE_FORWARD_OAUTH_TOKEN: True
      # Authentication settings (https://docs.openwebui.com/features/sso#oidc)
      ENABLE_SIGNUP: True
#      ENABLE_LOGIN_FORM: True
      ENABLE_API_KEY: False
      OAUTH_CLIENT_ID: "bwell-client-id"
      OPENID_PROVIDER_URL: "http://keycloak:8080/realms/bwell-realm/.well-known/openid-configuration"
      OAUTH_CLIENT_SECRET: "bwell-secret"
      ENABLE_OAUTH_SIGNUP: True
      OAUTH_PROVIDER_NAME: "keycloak"
      OAUTH_SCOPES: "openid email"
      OAUTH_USERNAME_CLAIM: "email"
      WEBUI_URL: "https://open-webui.localhost"

  openid-connect-debugger:
    image: leplusorg/openid-connect-provider-debugger:latest
#    network_mode: "host"
    ports:
      - "8085:80"
    environment:
      # http://localhost:8085/debug?oidc_client_id=bwell-client-id&oidc_client_secret=bwell-secret&oidc_discovery=http%3A%2F%2Fkeycloak%3A8080%2Frealms%2Fbwell-realm%2F.well-known%2Fopenid-configuration&oidc_redirect_uri=http%3A%2F%2Flocalhost%3A8085%2Fcallback
      # Configure to match your Keycloak OpenID Connect settings
      - ISSUER_URL=http://keycloak:8080/realms/bwell-realm
      - oidc_client_id=bwell-client-id
      - oidc_client_secret=bwell-secret
      - oidc_discovery=http://keycloak:8080/realms/bwell-realm/.well-known/openid-configuration
      - oidc_redirect_uri=http://localhost:8085/callback
      - oidc_scope=openid email
      - oidc_ssl_verify=no
    depends_on:
      - keycloak
    networks:
      - web
